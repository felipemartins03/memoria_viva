<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memória Viva - Repositório de Projetos</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #2c3e50;
        background-color: #f8fafc;
        overflow-x: hidden;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }
      header {
        background: #003366;
        color: white;
        padding: 1.5rem 0;
        box-shadow: 0 4px 20px rgba(0, 51, 102, 0.15);
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
      .logo {
        font-size: 2rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.8rem;
      }
      .logo i {
        font-size: 1.8rem;
      }
       .logo-link {
        text-decoration: none;
        color: white; 
      }
      nav ul {
        list-style: none;
        display: flex;
        gap: 2.5rem;
      }
      nav a {
        color: white;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        position: relative;
      }
      nav a:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      nav a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -5px;
        left: 50%;
        background-color: #ff6600;
        transition: all 0.3s ease;
        transform: translateX(-50%);
      }
      nav a:hover::after {
        width: 80%;
      }
      #home {
        padding-top: 2rem;
        padding-bottom: 2rem;
      }
      .hero-banner {
        background-color: #002244;
        color: white;
        padding: 6rem 3rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        border-radius: 24px;
      }
      .hero-banner::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><g fill-opacity="0.1"><circle fill="%23FF6600" cx="100" cy="100" r="150" /><circle fill="%23FFFFFF" cx="700" cy="600" r="100" /><rect fill="%23FF6600" x="300" y="200" width="200" height="200" transform="rotate(45 400 300)" /><path fill="%23FFFFFF" d="M 500 500 L 550 550 L 500 600 Z" /></g></svg>');
        animation: rotateBackground 60s linear infinite;
        z-index: 0;
      }
      @keyframes rotateBackground {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .hero-content {
        position: relative;
        z-index: 1;
      }
      .hero-banner h1 {
        font-size: 3.5rem;
        font-weight: 800;
        margin-bottom: 1rem;
      }
      .hero-banner p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto 2.5rem auto;
        opacity: 0.9;
      }
      .hero-banner .btn-primary {
        background-color: #ff6600;
        border: 2px solid #ff6600;
        color: white;
      }
      .hero-banner .btn-primary:hover {
        background-color: #e55a00;
        border-color: #e55a00;
      }
      .hero-banner .btn-secondary {
        background-color: transparent;
        border: 2px solid white;
        color: white;
      }
      .hero-banner .btn-secondary:hover {
        background-color: white;
        color: #002244;
      }
      .btn {
        padding: 14px 28px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        border: none;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .section {
        padding: 4rem 0;
        display: none;
      }
      .section.active {
        display: block;
      }
      #home.section.active {
        padding: 0;
        padding-top: 2rem;
        padding-bottom: 2rem;
      }
      .section h2 {
        color: #003366;
        margin-bottom: 3rem;
        text-align: center;
        font-size: 2.8rem;
        font-weight: 700;
      }
      .form-container,
      .filters-container,
      .project-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      }
      .form-container {
        padding: 3rem;
        max-width: 700px;
        margin: 0 auto;
      }
      .form-group {
        margin-bottom: 2rem;
      }
      .form-group label {
        display: block;
        margin-bottom: 0.8rem;
        color: #2c3e50;
        font-weight: 600;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background-color: #f8fafc;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #ff6600;
        background-color: white;
        box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.1);
      }
      .form-group-row {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .form-group-row .form-group {
        flex: 1;
        min-width: 150px;
      }
      .integrantes-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .integrante-item {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .integrante-item input {
        flex-grow: 1;
      }
      .btn-remove-integrante {
        background: #ef4444; color: white; border: none;
        border-radius: 8px; width: 40px; height: 40px;
        cursor: pointer; font-weight: bold;
      }
      .btn-add-integrante {
        background: #22c55e; color: white; border: none;
        padding: 10px 15px; border-radius: 8px;
        cursor: pointer; margin-top: 10px; font-weight: 500;
      }
      .filters-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1.5rem;
        align-items: end;
        margin-bottom: 2.5rem;
        padding: 2rem;
      }
      .filter-item label {
        display: block; margin-bottom: 0.5rem; font-weight: 500;
        color: #334155; font-size: 0.9rem;
      }
      .filter-item input, .filter-item select {
        width: 100%; padding: 14px; border: 2px solid #e2e8f0;
        border-radius: 10px; font-size: 1rem;
      }
      .btn-accent {
        background-color: #ff6600; color: white; border: none;
      }
      .btn-accent:hover { background-color: #e55a00; }
      .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
      }
      .project-card {
        padding: 0; /* Removido padding para a imagem preencher */
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        border: 1px solid #e2e8f0;
      }
      .project-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
      .project-card .card-content {
        flex-grow: 1; 
        padding: 1.5rem;
      }
      .project-card h3 {
        color: #003366;
        margin-bottom: 1rem;
        text-transform: capitalize;
      }
      .project-card footer {
        border-top: 1px solid #eee;
        padding: 1rem 1.5rem;
        color: #003366;
        font-weight: 600;
        background-color: #f8f9fa;
        border-radius: 0 0 16px 16px;
      }
      .project-meta {
        display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;
      }
      .project-tag {
        color: white; padding: 0.4rem 1rem;
        border-radius: 20px; font-size: 0.8rem; font-weight: 600;
      }
      .project-details p {
        margin-bottom: 0.75rem; color: #475569;
      }
      .project-details strong { color: #1e293b; }
      .empty-state {
        text-align: center; padding: 3rem; color: #666;
        grid-column: 1 / -1;
      }
      .success-message {
        background: #10b981; color: white; padding: 1rem;
        border-radius: 8px; margin-bottom: 1.5rem; display: none;
      }

      /* Estilos do Menu Hambúrguer e Responsividade */
      .desktop-nav { display: block; }
      .mobile-nav, .hamburger-btn { display: none; }
      .mobile-nav ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; align-items: center; gap: 1rem; }
      .mobile-nav a { color: white; text-decoration: none; padding: 0.8rem 1.5rem; border-radius: 8px; width: 90%; text-align: center; display: block; }
      .mobile-nav a:hover { background-color: rgba(255, 255, 255, 0.1); }
      @media (max-width: 768px) {
        .desktop-nav { display: none; }
        .hamburger-btn { display: block; background: transparent; border: none; color: white; font-size: 1.5rem; cursor: pointer; }
        .header-content { justify-content: space-between; }
        .mobile-nav.active { display: block; position: absolute; top: 100%; left: 0; width: 100%; background-color: #002244; padding: 1rem 0; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); z-index: 1001;}
        .filters-container, .projects-grid { grid-template-columns: 1fr; }
        .form-container { padding: 2rem; }
      }
      @media (max-width: 480px) {
        .logo { font-size: 1.7rem; }
        .hero-banner { padding: 4rem 2rem; }
        .hero-banner h1 { font-size: 2.5rem; }
        .hero-banner p { font-size: 1rem; }
      }

      /* Estilos para o Botão de Upload Personalizado */
      .file-upload-wrapper input[type="file"] { display: none; }
      .custom-file-upload {
        display: inline-block; background-color: #003366; color: white;
        padding: 12px 20px; border-radius: 8px; border: none;
        cursor: pointer; font-weight: 600; transition: background-color 0.3s ease;
      }
      .custom-file-upload:hover { background-color: #002244; }
      .custom-file-upload i { margin-right: 8px; }
      #file-name { margin-left: 15px; font-style: italic; color: #555; }
        
      /* ESTILOS PARA O MODAL DE DETALHES */
      .modal {
        display: none; position: fixed; z-index: 2000;
        left: 0; top: 0; width: 100%; height: 100%;
        overflow: auto; background-color: rgba(0,0,0,0.6);
        animation: fadeIn 0.3s;
      }
      .modal-content {
        background-color: #fff; margin: 5% auto; padding: 40px;
        border-radius: 16px; width: 80%; max-width: 800px;
        position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        animation: slideIn 0.4s ease-out;
      }
      .close-button {
        color: #aaa; position: absolute; top: 15px; right: 25px;
        font-size: 28px; font-weight: bold; cursor: pointer;
      }
      .close-button:hover, .close-button:focus { color: #000; }
      @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
      @keyframes slideIn { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

      /* Estilos para a Página Sobre Nós */
      .manifesto p { font-size: 1.1rem; line-height: 1.7; text-align: center; max-width: 800px; margin: 1rem auto; color: #475569; }
      .equipe-grid { display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-top: 2rem; }
      .equipe-card { background: white; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); padding: 2rem; text-align: center; width: 280px; }
      .equipe-card img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; border: 4px solid #f0f4f8; }
      .equipe-card h4 { font-size: 1.4rem; color: #003366; margin-bottom: 0.25rem; }
      .equipe-card .funcao { color: #FF6600; font-weight: 600; margin-bottom: 1rem; }
      .equipe-card .bio { font-style: italic; color: #64748b; margin-bottom: 1.5rem; }
      .social-links a { color: #003366; text-decoration: none; font-size: 1.5rem; margin: 0 0.5rem; transition: color 0.3s; }
      .social-links a:hover { color: #FF6600; }
      .call-to-action { text-align: center; margin-top: 4rem; background-color: #f8fafc; padding: 2.5rem; border-radius: 16px; }
      .call-to-action h3 { color: #003366; font-size: 1.8rem; margin-bottom: 1.5rem; }

    </style>
  </head>
  <body>
    <script>
      const SUPABASE_URL = "SUA_URL_DO_SUPABASE";
      const SUPABASE_ANON_KEY = "SUA_CHAVE_ANON_PUBLICA";
      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    </script>
    
    <header>
      <div class="container">
        <div class="header-content">
          <a href="#" onclick="showSection('home')" class="logo-link">
            <div class="logo"><i class="fas fa-book-open"></i> Memória Viva</div>
          </a>
          <button class="hamburger-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
          </button>
          <nav class="desktop-nav">
            <ul>
              <li><a onclick="showSection('home'); closeMobileMenu();">Início</a></li>
              <li><a onclick="showSection('cadastro'); closeMobileMenu();">Cadastrar Projeto</a></li>
              <li><a onclick="showSection('projetos'); closeMobileMenu();">Consultar Projetos</a></li>
              <li><a onclick="showSection('sobre-nos'); closeMobileMenu();">Sobre Nós</a></li>
            </ul>
          </nav>
        </div>
      </div>
      <nav class="mobile-nav">
        <ul>
            <li><a onclick="showSection('home'); closeMobileMenu();">Início</a></li>
            <li><a onclick="showSection('cadastro'); closeMobileMenu();">Cadastrar Projeto</a></li>
            <li><a onclick="showSection('projetos'); closeMobileMenu();">Consultar Projetos</a></li>
            <li><a onclick="showSection('sobre-nos'); closeMobileMenu();">Sobre Nós</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="home" class="section active">
        </section>

      <section id="cadastro" class="section">
        <div class="container">
          <h2>Cadastrar Novo Projeto</h2>
          <div class="form-container">
            <div class="success-message" id="successMessage">Projeto cadastrado com sucesso!</div>
            <form id="projectForm">
                <div class="form-group">
                    <label for="nomeProjeto">Nome do Projeto *</label>
                    <input type="text" id="nomeProjeto" name="nomeProjeto" required />
                </div>

                <div class="form-group">
                    <label for="area">Área do Curso *</label>
                    <select id="area" name="area" required>
                        <option value="" disabled selected>Selecione uma área</option>
                        <option value="Aprendizagem">Aprendizagem</option>
                        <option value="Beleza e Estética">Beleza e Estética</option>
                        <option value="Bem-estar">Bem-estar</option>
                        <option value="Comunicação e Marketing">Comunicação e Marketing</option>
                        <option value="Desenvolvimento Social">Desenvolvimento Social</option>
                        <option value="Design, Artes e Arquitetura">Design, Artes e Arquitetura</option>
                        <option value="Educação">Educação</option>
                        <option value="Gastronomia e Alimentação">Gastronomia e Alimentação</option>
                        <option value="Gestão e Negócios">Gestão e Negócios</option>
                        <option value="Idiomas">Idiomas</option>
                        <option value="Meio Ambiente, Segurança e Saúde no Trabalho">Meio Ambiente, Segurança e Saúde no Trabalho</option>
                        <option value="Moda">Moda</option>
                        <option value="Saúde">Saúde</option>
                        <option value="Tecnologia da Informação">Tecnologia da Informação</option>
                        <option value="Turismo e Hospitalidade">Turismo e Hospitalidade</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="modalidade">Modalidade do Curso *</label>
                    <select id="modalidade" name="modalidade" required>
                        <option value="" disabled selected>Selecione a modalidade</option>
                        <option value="Especialização Técnica">Especialização Técnica</option>
                        <option value="Técnico">Técnico</option>
                        <option value="Livre">Livre</option>
                        <option value="Graduação EAD">Graduação EAD</option>
                        <option value="Pós-graduação EAD">Pós-graduação EAD</option>
                        <option value="Jovem Aprendiz">Jovem Aprendiz</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="turma">Nome da Turma / Identificador *</label>
                    <input type="text" id="turma" name="turma" placeholder="Ex: Téc. em ADS 2025.1" required />
                </div>
                
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="data_inicio">Data de Início *</label>
                        <input type="date" id="data_inicio" name="data_inicio" required>
                    </div>
                    <div class="form-group">
                        <label for="data_termino">Data de Término</label>
                        <input type="date" id="data_termino" name="data_termino">
                    </div>
                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" name="status" required>
                            <option value="Em andamento">Em andamento</option>
                            <option value="Concluído">Concluído</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="docente">Nome do Docente Orientador *</label>
                    <input type="text" id="docente" name="docente" required />
                </div>
                
                <div class="form-group">
                    <label>Integrantes do Grupo *</label>
                    <div id="integrantesContainer" class="integrantes-list">
                        <div class="integrante-item">
                            <input type="text" name="integrantes[]" placeholder="Nome completo do integrante" required />
                        </div>
                    </div>
                    <button type="button" class="btn-add-integrante" onclick="addIntegrante()">+ Adicionar Integrante</button>
                </div>

                <div class="form-group">
                    <label for="descricao">Descrição do Projeto *</label>
                    <textarea id="descricao" name="descricao" placeholder="Descreva o objetivo, metodologia e principais resultados do seu projeto..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="midiaProjeto">Imagem ou Vídeo de Capa (opcional)</label>
                    <div class="file-upload-wrapper">
                        <label for="midiaProjeto" class="custom-file-upload"><i class="fas fa-cloud-upload-alt"></i> Escolher Arquivo</label>
                        <span id="file-name">Nenhum arquivo selecionado</span>
                        <input type="file" id="midiaProjeto" name="midiaProjeto" accept="image/*, video/*" />
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Cadastrar Projeto</button>
            </form>
          </div>
        </div>
      </section>

      <section id="projetos" class="section">
        <div class="container">
          <h2>Projetos Cadastrados</h2>
          <div class="filters-container">
            <div class="filter-item">
                <label for="filterModalidade">Filtrar por Modalidade:</label>
                <select id="filterModalidade">
                    <option value="">Todas</option>
                    <option value="Especialização Técnica">Especialização Técnica</option>
                    <option value="Técnico">Técnico</option>
                    <option value="Livre">Livre</option>
                    <option value="Graduação EAD">Graduação EAD</option>
                    <option value="Pós-graduação EAD">Pós-graduação EAD</option>
                    <option value="Jovem Aprendiz">Jovem Aprendiz</option>
                </select>
            </div>
            
            <div class="filter-item">
                <label for="filterArea">Filtrar por Área:</label>
                <select id="filterArea">
                    <option value="">Todas as áreas</option>
                    <option value="Aprendizagem">Aprendizagem</option>
                    <option value="Beleza e Estética">Beleza e Estética</option>
                    <option value="Bem-estar">Bem-estar</option>
                    <option value="Comunicação e Marketing">Comunicação e Marketing</option>
                    <option value="Desenvolvimento Social">Desenvolvimento Social</option>
                    <option value="Design, Artes e Arquitetura">Design, Artes e Arquitetura</option>
                    <option value="Educação">Educação</option>
                    <option value="Gastronomia e Alimentação">Gastronomia e Alimentação</option>
                    <option value="Gestão e Negócios">Gestão e Negócios</option>
                    <option value="Idiomas">Idiomas</option>
                    <option value="Meio Ambiente, Segurança e Saúde no Trabalho">Meio Ambiente, Segurança e Saúde no Trabalho</option>
                    <option value="Moda">Moda</option>
                    <option value="Saúde">Saúde</option>
                    <option value="Tecnologia da Informação">Tecnologia da Informação</option>
                    <option value="Turismo e Hospitalidade">Turismo e Hospitalidade</option>
                </select>
            </div>
            
            <div class="filter-item">
              <label for="filterKeyword">Buscar por Palavra-Chave:</label>
              <input type="text" id="filterKeyword" placeholder="Nome do projeto, descrição..." />
            </div>
            
            <div class="filter-item">
              <label for="filterAno">Filtrar por Ano de Início:</label>
              <select id="filterAno"><option value="">Todos os anos</option></select>
            </div>
          </div>
          <div id="projectsContainer" class="projects-grid"></div>
        </div>
      </section>

      <section id="sobre-nos" class="section">
        <div class="container">
            <h2>Nossa História: Da Ideia ao Impacto</h2>

            <div class="manifesto">
                <p>
                    Todo projeto de conclusão de curso deixa um legado. O Memória Viva
                    garante que esse legado, especialmente o de impacto social, não
                    seja apenas uma memória. Nossa plataforma foi desenhada para
                    preservar cada Projeto Integrador, permitindo que o trabalho de
                    uma turma sirva de ponto de partida para a próxima. Conectamos
                    estudantes a benfeitorias que necessitam de apoio constante,
                    transformando o esforço acadêmico em um movimento que ganha força
                    a cada nova turma.
                </p>
            </div>

            <h3 style="text-align: center; margin-top: 3rem; margin-bottom: 2rem; color: #003366;">Os Idealizadores</h3>
            
            <div class="equipe-grid">
                <div class="equipe-card">
                    <img src="https://felipemartins03.github.io/memoria_viva/Imagens/felipe_martins.jpeg" alt="Foto do Felipe Martins" />
                    <h4>Felipe Martins</h4>
                    <p class="funcao">Desenvolvedor & Idealizador</p>
                    <p class="bio">"Acredito que a tecnologia pode ser a ponte para que boas ideias nunca morram."</p>
                    <div class="social-links">
                        <a href="https://www.linkedin.com/in/ifelipemartins/" target="_blank"><i class="fab fa-linkedin"></i></a>
                        <a href="https://github.com/felipemartins03" target="_blank"><i class="fab fa-github"></i></a>
                    </div>
                </div>

                <div class="equipe-card">
                    <img src="https://www.amazon.com/Colega-Libro-Alumno-EJERCICIOS-Spanish/dp/8477116563" alt="Foto do Colega 1" />
                    <h4>[NOME DO COLEGA 1]</h4>
                    <p class="funcao">[FUNÇÃO DO COLEGA 1]</p>
                    <p class="bio">"[FRASE DO COLEGA 1]"</p>
                    <div class="social-links">
                        <a href="[LINKEDIN DO COLEGA 1]" target="_blank"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>

                <div class="equipe-card">
                    <img src="https://es.scribd.com/document/474715849/Colega-2-Libro-1-pdf" alt="Foto do Colega 2" />
                    <h4>[NOME DO COLEGA 2]</h4>
                    <p class="funcao">[FUNÇÃO DO COLEGA 2]</p>
                    <p class="bio">"[FRASE DO COLEGA 2]"</p>
                    <div class="social-links">
                        <a href="[LINKEDIN DO COLEGA 2]" target="_blank"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>

            <div class="call-to-action">
                <h3>Faça Parte Deste Legado</h3>
                <div>
                    <a href="#" class="btn" onclick="showSection('projetos')">Continuar um Projeto</a>
                    <a href="#" class="btn" onclick="showSection('cadastro')" style="margin-left: 1rem;">Compartilhar Projeto</a>
                </div>
            </div>
        </div>
      </section>
    </main>

    <footer style="background: #003366; color: white; text-align: center; padding: 2rem 0; margin-top: 3rem;">
      <div class="container">
        <p>&copy; 2025 Memória Viva. Onde cada projeto tem um próximo capítulo.</p>
      </div>
    </footer>

    <div id="projectModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="fecharModalDetalhes()">&times;</span>
        <div id="modalBody"></div>
      </div>
    </div>

    <script>
      let projects = [];

      function toggleMobileMenu() {
        document.querySelector(".mobile-nav").classList.toggle("active");
      }
      function closeMobileMenu() {
        document.querySelector(".mobile-nav").classList.remove("active");
      }
      
      async function fetchAndDisplayProjects() {
        const { data, error } = await supabaseClient
          .from("db_memoria_viva")
          .select("*")
          .order("created_at", { ascending: false });

        if (error) {
          console.error("Erro ao buscar projetos:", error);
        } else {
          projects = data;
          displayProjects();
          populateFilterYears();
        }
      }

      document.getElementById("projectForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const submitButton = form.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = "Enviando...";

        const midiaArquivo = form.querySelector("#midiaProjeto").files?.[0];
        let urlDaMidia = null;

        if (midiaArquivo) {
          const nomeArquivo = `${Date.now()}_${midiaArquivo.name.replace(/\s/g,"_")}`;
          const { data: uploadData, error: uploadError } = await supabaseClient.storage
            .from("midia-projetos")
            .upload(nomeArquivo, midiaArquivo);

          if (uploadError) {
            console.error("Erro no upload da mídia:", uploadError);
            alert(`Erro no upload: ${uploadError.message}`);
            submitButton.disabled = false;
            submitButton.textContent = "Cadastrar Projeto";
            return;
          }
          const { data: publicUrlData } = supabaseClient.storage
            .from("midia-projetos")
            .getPublicUrl(nomeArquivo);
          urlDaMidia = publicUrlData.publicUrl;
        }

        const integrantesList = Array.from(document.querySelectorAll('input[name="integrantes[]"]'))
            .map((input) => input.value.trim())
            .filter(Boolean);

        if (integrantesList.length === 0) {
          alert("Adicione pelo menos um integrante.");
          submitButton.disabled = false;
          submitButton.textContent = "Cadastrar Projeto";
          return;
        }

        const formData = new FormData(form);
        const projectData = {
            integrantes: integrantesList,
            nome_projeto: formData.get("nomeProjeto"),
            area: formData.get("area"),
            modalidade: formData.get("modalidade"),
            data_inicio: formData.get("data_inicio"),
            data_termino: formData.get("data_termino") || null,
            status: formData.get("status"),
            turma: formData.get("turma"),
            docente: formData.get("docente"),
            ano: new Date(formData.get("data_inicio")).getFullYear(),
            descricao: formData.get("descricao"),
            url_midia: urlDaMidia,
        };

        const { error: insertError } = await supabaseClient
            .from("db_memoria_viva")
            .insert([projectData]);

        if (insertError) {
            console.error("Erro ao cadastrar projeto:", insertError);
            alert("Ocorreu um erro ao cadastrar o projeto. Tente novamente.");
            submitButton.disabled = false;
            submitButton.textContent = "Cadastrar Projeto";
        } else {
            const successMessage = document.getElementById("successMessage");
            successMessage.style.display = "block";
            setTimeout(() => (successMessage.style.display = "none"), 4000);
            form.reset();
            document.getElementById("integrantesContainer").innerHTML = `<div class="integrante-item"><input type="text" name="integrantes[]" placeholder="Nome completo do integrante" required></div>`;
            document.getElementById("file-name").textContent = "Nenhum arquivo selecionado";
            submitButton.disabled = false;
            submitButton.textContent = "Cadastrar Projeto";
            await fetchAndDisplayProjects();
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        populateYearOptions();
        fetchAndDisplayProjects();
        document.getElementById("midiaProjeto").addEventListener("change", function () {
            const fileNameSpan = document.getElementById("file-name");
            if (this.files && this.files.length > 0) {
              fileNameSpan.textContent = this.files[0].name;
            } else {
              fileNameSpan.textContent = "Nenhum arquivo selecionado";
            }
          });
      });

      function showSection(sectionId) {
        document.querySelectorAll(".section").forEach((section) => section.classList.remove("active"));
        document.getElementById(sectionId).classList.add("active");
        window.scrollTo(0, 0);
        if (sectionId === "projetos") {
          applyFilters();
        }
      }

      function populateYearOptions() {
        const currentYear = new Date().getFullYear() + 1; // Allow future years
        const startYear = 2015; // Go further back
        const yearSelects = document.querySelectorAll('#filterAno');
        yearSelects.forEach(select => {
            let options = '<option value="">Todos os anos</option>';
            for (let year = currentYear; year >= startYear; year--) {
                options += `<option value="${year}">${year}</option>`;
            }
            select.innerHTML = options;
        });
      }

      function addIntegrante() {
        const container = document.getElementById("integrantesContainer");
        const newIntegrante = document.createElement("div");
        newIntegrante.className = "integrante-item";
        newIntegrante.innerHTML = `<input type="text" name="integrantes[]" placeholder="Nome completo do integrante" required><button type="button" class="btn-remove-integrante" onclick="this.parentElement.remove()">X</button>`;
        container.appendChild(newIntegrante);
      }

      function populateFilterYears() {
        const filterAno = document.getElementById("filterAno");
        const anos = [...new Set(projects.map((p) => p.ano))].sort((a, b) => b - a);
        const optionsHTML = anos.map((ano) => `<option value="${ano}">${ano}</option>`).join("");
        filterAno.innerHTML = '<option value="">Todos os anos</option>' + optionsHTML;
      }

      function displayProjects(projectsToDisplay = projects) {
        const container = document.getElementById("projectsContainer");
        if (!projectsToDisplay || projectsToDisplay.length === 0) {
          container.innerHTML = `<div class="empty-state"><h3>Nenhum projeto encontrado</h3><p>Seja o primeiro a cadastrar ou ajuste sua busca.</p></div>`;
          return;
        }
        container.innerHTML = projectsToDisplay.map((p) => {
            const dataFormatada = new Date(p.created_at).toLocaleDateString("pt-BR", {timeZone: 'UTC'});
            const descricaoCurta = p.descricao.length > 100 ? p.descricao.substring(0, 100) + "..." : p.descricao;
            
            let midiaHtml = '';
            const placeholderSvg = `<div style="width:100%; aspect-ratio: 16/9; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; border-radius: 16px 16px 0 0; border-bottom: 1px solid #e9ecef;"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="#cccccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8.5 10C9.32843 10 10 9.32843 10 8.5C10 7.67157 9.32843 7 8.5 7C7.67157 7 7 7.67157 7 8.5C7 9.32843 7.67157 10 8.5 10Z" stroke="#cccccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 15L16 10L5 21" stroke="#cccccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`;
            
            if (p.url_midia) {
                const estiloMidia = `width:100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 16px 16px 0 0;`;
                if (p.url_midia.match(/\.(jpeg|jpg|gif|png)$/i)) {
                    midiaHtml = `<img src="${p.url_midia}" alt="Capa do projeto" style="${estiloMidia}">`;
                } else if (p.url_midia.match(/\.(mp4|webm|ogg)$/i)) {
                    midiaHtml = `<video controls style="${estiloMidia}"><source src="${p.url_midia}" type="video/mp4"></video>`;
                } else {
                    midiaHtml = placeholderSvg;
                }
            } else {
                midiaHtml = placeholderSvg;
            }

            const statusCor = p.status === 'Concluído' ? '#28a745' : '#fd7e14';

            return `
            <div class="project-card" onclick="abrirModalDetalhes(${p.id})">
                ${midiaHtml}
                <div class="card-content">
                    <h3>${p.nome_projeto}</h3>
                    <div class="project-meta">
                        <span class="project-tag" style="background-color: ${statusCor};">${p.status}</span>
                        <span class="project-tag" style="background-color: #007bff;">${p.area}</span>
                        <span class="project-tag">${p.modalidade}</span>
                    </div>
                    <div class="project-details">
                        <p><strong>Turma:</strong> ${p.turma}</p>
                        <p>${descricaoCurta}</p>
                    </div>
                </div>
                <footer">Ver mais detalhes</footer>
            </div>`;
        }).join("");
      }

      function applyFilters() {
        const keyword = document.getElementById("filterKeyword").value.toLowerCase().trim();
        const turma = document.getElementById("filterTurma").value.toLowerCase().trim();
        const ano = document.getElementById("filterAno").value;
        const area = document.getElementById("filterArea").value;
        const modalidade = document.getElementById("filterModalidade").value;

        const filtered = projects.filter((p) => {
          const searchString = `${p.nome_projeto} ${p.descricao} ${(p.integrantes || []).join(" ")} ${p.docente}`.toLowerCase();
          const keywordMatch = keyword ? searchString.includes(keyword) : true;
          const turmaMatch = turma ? p.turma.toLowerCase().includes(turma) : true;
          const anoMatch = ano ? String(p.ano) === ano : true;
          const areaMatch = area ? p.area === area : true;
          const modalidadeMatch = modalidade ? p.modalidade === modalidade : true;
          return keywordMatch && turmaMatch && anoMatch && areaMatch && modalidadeMatch;
        });
        displayProjects(filtered);
      }

      function clearFilters() {
        document.getElementById("filterKeyword").value = "";
        document.getElementById("filterTurma").value = "";
        document.getElementById("filterAno").value = "";
        document.getElementById("filterArea").value = "";
        document.getElementById("filterModalidade").value = "";
        displayProjects(projects);
      }
      
      function abrirModalDetalhes(projectId) {
        const projeto = projects.find(p => p.id === projectId);
        if (!projeto) return;

        const modal = document.getElementById('projectModal');
        const modalBody = document.getElementById('modalBody');

        const inicioFmt = new Date(projeto.data_inicio).toLocaleDateString('pt-BR', { timeZone: 'UTC' });
        const terminoFmt = projeto.data_termino ? new Date(projeto.data_termino).toLocaleDateString('pt-BR', { timeZone: 'UTC' }) : 'Presente';
        const statusCor = projeto.status === 'Concluído' ? '#28a745' : '#fd7e14';

        let midiaHtml = '';
        if (projeto.url_midia) {
            if (projeto.url_midia.match(/\.(jpeg|jpg|gif|png)$/i)) {
                midiaHtml = `<img src="${projeto.url_midia}" alt="Capa" style="width:100%; border-radius: 8px; margin-bottom: 1rem;">`;
            } else if (projeto.url_midia.match(/\.(mp4|webm|ogg)$/i)) {
                midiaHtml = `<video controls style="width:100%; border-radius: 8px; margin-bottom: 1rem;"><source src="${projeto.url_midia}" type="video/mp4"></video>`;
            }
        }

        modalBody.innerHTML = `
            ${midiaHtml}
            <span class="project-tag" style="background-color: ${statusCor}; font-size: 1rem; margin-bottom: 1rem; display: inline-block;">${projeto.status}</span>
            <h2>${projeto.nome_projeto}</h2>
            <p><strong>Área:</strong> ${projeto.area} | <strong>Modalidade:</strong> ${projeto.modalidade}</p>
            <p><strong>Período:</strong> ${inicioFmt} a ${terminoFmt}</p>
            <p><strong>Turma:</strong> ${projeto.turma}</p>
            <p><strong>Docente:</strong> ${projeto.docente}</p>
            <p><strong>Integrantes:</strong> ${projeto.integrantes ? projeto.integrantes.join(', ') : 'N/A'}</p>
            <hr style="margin: 20px 0;">
            <p>${projeto.descricao.replace(/\n/g, '<br>')}</p> 
        `;

        modal.style.display = "block";
      }

      function fecharModalDetalhes() {
        document.getElementById('projectModal').style.display = "none";
      }
    </script>
  </body>
</html>
